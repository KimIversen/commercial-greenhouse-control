title: Commercial Greenhouse Control
views:
  - title: Overview
    path: overview
    icon: mdi:greenhouse
    cards:
      # System Status Header
      - type: horizontal-stack
        cards:
          - type: entity
            entity: binary_sensor.greenhouse_climate_1_status
            name: Climate 1
            icon: mdi:thermometer
          - type: entity
            entity: binary_sensor.greenhouse_climate_2_status  
            name: Climate 2
            icon: mdi:thermometer
          - type: entity
            entity: sensor.greenhouse_soil_1_average_vwc
            name: Soil Zone 1
            icon: mdi:water-percent
          - type: entity
            entity: sensor.greenhouse_soil_2_average_vwc
            name: Soil Zone 2 (Battery)
            icon: mdi:battery-70

      # Environmental Conditions
      - type: entities
        title: Current Conditions
        show_header_toggle: false
        entities:
          - entity: sensor.greenhouse_climate_1_temperature
            name: Temperature Zone 1
          - entity: sensor.greenhouse_climate_1_humidity
            name: Humidity Zone 1
          - entity: sensor.greenhouse_climate_2_temperature
            name: Temperature Zone 2
          - entity: sensor.greenhouse_climate_2_humidity
            name: Humidity Zone 2
          - type: divider
          - entity: sensor.greenhouse_soil_1_average_vwc
            name: Soil Moisture Zone 1
          - entity: sensor.greenhouse_soil_2_average_vwc
            name: Soil Moisture Zone 2
          - entity: sensor.greenhouse_soil_2_battery_level
            name: Zone 2 Battery Level

      # Quick Actions
      - type: entities
        title: Device Controls
        show_header_toggle: false
        entities:
          - entity: switch.greenhouse_climate_1_ota_mode
            name: Climate 1 OTA Mode
          - entity: switch.greenhouse_climate_2_ota_mode
            name: Climate 2 OTA Mode
          - entity: switch.greenhouse_soil_2_ota_mode
            name: Soil 2 OTA Mode
          - entity: sensor.greenhouse_soil_2_sleep_status
            name: Soil 2 Status

  - title: Climate
    path: climate
    icon: mdi:thermometer-lines
    cards:
      # Temperature Overview
      - type: custom:mini-graph-card
        entities:
          - entity: sensor.greenhouse_climate_1_temperature
            name: Zone 1
          - entity: sensor.greenhouse_climate_2_temperature
            name: Zone 2
        name: Temperature Trends
        hours_to_show: 24
        points_per_hour: 2
        line_width: 2
        animate: true
        show:
          extrema: true
          average: true

      # Humidity Overview  
      - type: custom:mini-graph-card
        entities:
          - entity: sensor.greenhouse_climate_1_humidity
            name: Zone 1
          - entity: sensor.greenhouse_climate_2_humidity
            name: Zone 2
        name: Humidity Trends
        hours_to_show: 24
        points_per_hour: 2
        line_width: 2
        animate: true
        show:
          extrema: true
          average: true

      # Current Readings
      - type: horizontal-stack
        cards:
          - type: gauge
            entity: sensor.greenhouse_climate_1_temperature
            name: Zone 1 Temperature
            min: 0
            max: 40
            severity:
              green: 18
              yellow: 25
              red: 30
          - type: gauge
            entity: sensor.greenhouse_climate_2_temperature
            name: Zone 2 Temperature
            min: 0
            max: 40
            severity:
              green: 18
              yellow: 25
              red: 30

      - type: horizontal-stack
        cards:
          - type: gauge
            entity: sensor.greenhouse_climate_1_humidity
            name: Zone 1 Humidity
            min: 0
            max: 100
            severity:
              green: 60
              yellow: 80
              red: 90
          - type: gauge
            entity: sensor.greenhouse_climate_2_humidity
            name: Zone 2 Humidity
            min: 0
            max: 100
            severity:
              green: 60
              yellow: 80
              red: 90

      # Device Status
      - type: entities
        title: Climate Device Status
        show_header_toggle: false
        entities:
          - entity: binary_sensor.greenhouse_climate_1_status
            name: Zone 1 Device Status
          - entity: sensor.greenhouse_climate_1_wifi_signal
            name: Zone 1 WiFi Signal
          - entity: binary_sensor.greenhouse_climate_2_status
            name: Zone 2 Device Status
          - entity: sensor.greenhouse_climate_2_wifi_signal
            name: Zone 2 WiFi Signal

  - title: Soil Monitoring
    path: soil
    icon: mdi:water-percent
    cards:
      # Soil Moisture Trends
      - type: custom:mini-graph-card
        entities:
          - entity: sensor.greenhouse_soil_1_average_vwc
            name: Zone 1 (3 sensors)
          - entity: sensor.greenhouse_soil_2_average_vwc
            name: Zone 2 (2 sensors, battery)
        name: Soil Moisture Trends
        hours_to_show: 48
        points_per_hour: 1
        line_width: 3
        animate: true
        show:
          extrema: true
          average: true
        color_thresholds:
          - value: 35
            color: "#e74c3c"
          - value: 45
            color: "#f39c12"
          - value: 60
            color: "#27ae60"

      # Zone 1 Detailed View (3 sensors)
      - type: entities
        title: Soil Zone 1 - Individual Sensors (Powered)
        show_header_toggle: false
        entities:
          - entity: sensor.greenhouse_soil_1_1_vwc
            name: Sensor 1.1
          - entity: sensor.greenhouse_soil_1_2_vwc
            name: Sensor 1.2
          - entity: sensor.greenhouse_soil_1_3_vwc
            name: Sensor 1.3
          - type: divider
          - entity: sensor.greenhouse_soil_1_average_vwc
            name: Zone 1 Average

      # Zone 2 Detailed View (2 sensors + battery)
      - type: entities
        title: Soil Zone 2 - Battery Powered Monitor
        show_header_toggle: false
        entities:
          - entity: sensor.greenhouse_soil_2_vwc_sensor_1
            name: Soil Sensor 1
          - entity: sensor.greenhouse_soil_2_vwc_sensor_2
            name: Soil Sensor 2
          - type: divider
          - entity: sensor.greenhouse_soil_2_average_vwc
            name: Zone 2 Average
          - type: divider
          - entity: sensor.greenhouse_soil_2_temperature_1
            name: Soil Temperature 1
          - entity: sensor.greenhouse_soil_2_temperature_2
            name: Soil Temperature 2
          - entity: sensor.greenhouse_soil_2_air_temperature_1
            name: Air Temperature 1
          - entity: sensor.greenhouse_soil_2_air_temperature_2
            name: Air Temperature 2
          - entity: sensor.greenhouse_soil_2_air_humidity_1
            name: Air Humidity 1
          - entity: sensor.greenhouse_soil_2_air_humidity_2
            name: Air Humidity 2

      # Moisture Status Gauges
      - type: horizontal-stack
        cards:
          - type: gauge
            entity: sensor.greenhouse_soil_1_average_vwc
            name: Zone 1 Moisture
            min: 0
            max: 75
            severity:
              green: 45
              yellow: 35
              red: 25
            needle: true
          - type: gauge
            entity: sensor.greenhouse_soil_2_average_vwc
            name: Zone 2 Moisture
            min: 0
            max: 75
            severity:
              green: 45
              yellow: 35
              red: 25
            needle: true

      # Individual Sensor Trends - Zone 1
      - type: custom:mini-graph-card
        entities:
          - entity: sensor.greenhouse_soil_1_1_vwc
            name: Sensor 1.1
          - entity: sensor.greenhouse_soil_1_2_vwc
            name: Sensor 1.2
          - entity: sensor.greenhouse_soil_1_3_vwc
            name: Sensor 1.3
        name: Zone 1 - Individual Sensor Trends
        hours_to_show: 24
        points_per_hour: 2
        line_width: 2
        animate: true

      # Individual Sensor Trends - Zone 2 (Battery)
      - type: custom:mini-graph-card
        entities:
          - entity: sensor.greenhouse_soil_2_vwc_sensor_1
            name: Soil Sensor 1
          - entity: sensor.greenhouse_soil_2_vwc_sensor_2
            name: Soil Sensor 2
        name: Zone 2 - Soil Moisture Trends (Battery)
        hours_to_show: 24
        points_per_hour: 2
        line_width: 2
        animate: true

  - title: Battery Monitor
    path: battery
    icon: mdi:battery
    cards:
      # Device Header with Status
      - type: custom:button-card
        entity: binary_sensor.greenhouse_soil_2_status
        name: Soil Monitor 2 (Battery Powered)
        icon: mdi:flower
        show_state: true
        styles:
          card:
            - background: >
                [[[ 
                  if (entity.state === 'on') return 'linear-gradient(90deg, #28a745, #20c997)';
                  else return 'linear-gradient(90deg, #dc3545, #fd7e14)';
                ]]]
            - color: white
            - font-weight: bold
            - padding: 15px
          icon:
            - color: white
            - width: 40px
          name:
            - font-size: 18px
          state:
            - font-size: 14px
        state_display: >
          [[[
            if (entity.state === 'on') return 'Online';
            else return 'Offline';
          ]]]

      # Battery and Power Management
      - type: horizontal-stack
        cards:
          - type: gauge
            entity: sensor.greenhouse_soil_2_battery_level
            name: Battery
            needle: true
            severity:
              green: 40
              yellow: 20
              red: 10
            min: 0
            max: 100
            unit: '%'
            
          - type: entities
            entities:
              - entity: sensor.greenhouse_soil_2_battery_voltage
                name: Voltage
                icon: mdi:flash
              - entity: sensor.greenhouse_soil_2_battery_days_remaining
                name: Est. Days Left
                icon: mdi:battery-clock
              - entity: sensor.greenhouse_soil_2_sleep_status
                name: Sleep Status
                icon: mdi:power-sleep

      # OTA and Device Controls
      - type: entities
        title: Device Controls
        show_header_toggle: false
        entities:
          - entity: switch.greenhouse_soil_2_ota_mode
            name: OTA Mode
            secondary_info: When ON, device stays awake for updates
          - type: divider
          - entity: script.soil2_enable_ota
            name: Wake for Update
            icon: mdi:upload
          - entity: script.soil2_disable_ota
            name: Force Sleep
            icon: mdi:sleep
          - entity: script.soil2_mark_battery_charged
            name: Mark Battery Charged
            icon: mdi:battery-charging
          - entity: script.soil2_battery_health_check
            name: Battery Health Check
            icon: mdi:battery-heart

      # Environmental Readings from Zone 2
      - type: grid
        columns: 2
        cards:
          # Soil Moisture
          - type: custom:mini-graph-card
            name: Soil Moisture
            entities:
              - entity: sensor.greenhouse_soil_2_vwc_sensor_1
                name: Sensor 1
                color: '#2196f3'
              - entity: sensor.greenhouse_soil_2_vwc_sensor_2
                name: Sensor 2
                color: '#4caf50'
              - entity: sensor.greenhouse_soil_2_average_vwc
                name: Average
                color: '#ff9800'
                show_fill: false
            hours_to_show: 24
            points_per_hour: 4
            line_width: 2
            show:
              labels: true
              legend: true

          # Temperature Readings
          - type: custom:mini-graph-card
            name: Temperature
            entities:
              - entity: sensor.greenhouse_soil_2_temperature_1
                name: Soil 1
                color: '#8b4513'
              - entity: sensor.greenhouse_soil_2_temperature_2
                name: Soil 2
                color: '#a0522d'
              - entity: sensor.greenhouse_soil_2_air_temperature_1
                name: Air 1
                color: '#87ceeb'
              - entity: sensor.greenhouse_soil_2_air_temperature_2
                name: Air 2
                color: '#4682b4'
            hours_to_show: 24
            points_per_hour: 4
            line_width: 2
            show:
              labels: true
              legend: true

          # Humidity Readings
          - type: custom:mini-graph-card
            name: Humidity
            entities:
              - entity: sensor.greenhouse_soil_2_air_humidity_1
                name: Sensor 1
                color: '#00bcd4'
              - entity: sensor.greenhouse_soil_2_air_humidity_2
                name: Sensor 2
                color: '#009688'
            hours_to_show: 24
            points_per_hour: 4
            line_width: 2
            show:
              labels: true
              legend: true
            unit: '%'

          # Device Health
          - type: entities
            title: Device Health
            entities:
              - entity: sensor.greenhouse_soil_2_wifi_rssi
                name: WiFi Signal
                icon: mdi:wifi
              - entity: sensor.greenhouse_soil_2_device_temperature
                name: CPU Temp
                icon: mdi:thermometer
              - entity: sensor.greenhouse_soil_2_uptime
                name: Uptime
                icon: mdi:clock-outline
              - entity: sensor.greenhouse_soil_2_free_heap
                name: Free Memory
                icon: mdi:memory

      # Battery History
      - type: custom:mini-graph-card
        name: Battery History (7 days)
        entities:
          - entity: sensor.greenhouse_soil_2_battery_level
            name: Battery Level
            color: >
              [[[
                const level = states['sensor.greenhouse_soil_2_battery_level'].state;
                if (level > 40) return '#4caf50';
                else if (level > 20) return '#ff9800';
                else return '#f44336';
              ]]]
        hours_to_show: 168
        points_per_hour: 0.25
        line_width: 2
        show:
          labels: true
          points: false
          average: true
          extrema: true

      # Battery Alerts
      - type: conditional
        conditions:
          - entity: binary_sensor.greenhouse_soil_2_low_battery
            state: 'on'
        card:
          type: custom:button-card
          name: Low Battery Warning
          icon: mdi:battery-alert
          styles:
            card:
              - background: '#ff9800'
              - color: white
              - padding: 10px
            icon:
              - color: white
          tap_action:
            action: call-service
            service: script.soil2_mark_battery_charged

  - title: System Health
    path: system
    icon: mdi:monitor-dashboard
    cards:
      # Device Connectivity
      - type: entities
        title: Device Connectivity
        show_header_toggle: false
        entities:
          - entity: binary_sensor.greenhouse_climate_1_status
            name: Climate Zone 1
          - entity: binary_sensor.greenhouse_climate_2_status
            name: Climate Zone 2
          - entity: binary_sensor.greenhouse_soil_2_status
            name: Soil Zone 2 (Battery)
          - type: divider
          - entity: sensor.greenhouse_climate_1_wifi_signal
            name: Climate 1 WiFi Signal
          - entity: sensor.greenhouse_climate_2_wifi_signal
            name: Climate 2 WiFi Signal
          - entity: sensor.greenhouse_soil_2_wifi_rssi
            name: Soil 2 WiFi Signal

      # System Resources 
      - type: entities
        title: System Resources
        show_header_toggle: false
        entities:
          - entity: sensor.cpu_usage
            name: CPU Usage
          - entity: sensor.memory_usage
            name: Memory Usage
          - entity: sensor.disk_usage
            name: Disk Usage

      # Database Health
      - type: entities
        title: Database Status
        show_header_toggle: false
        entities:
          - entity: sensor.database_size
            name: Database Size
          - entity: sensor.recorder_events
            name: Recorded Events (24h)
          - entity: sensor.recorder_states
            name: Recorded States (24h)

      # Docker Services Status
      - type: entities
        title: Docker Services
        show_header_toggle: false
        entities:
          - entity: binary_sensor.homeassistant_container
            name: Home Assistant
          - entity: binary_sensor.mariadb_container
            name: MariaDB
          - entity: binary_sensor.mosquitto_container
            name: MQTT Broker
          - entity: binary_sensor.esphome_container
            name: ESPHome

      # Maintenance Actions
      - type: entities
        title: Maintenance
        show_header_toggle: false
        entities:
          - entity: input_button.restart_homeassistant
            name: Restart Home Assistant
          - entity: input_button.manual_backup
            name: Manual Backup
          - type: divider
          - entity: switch.greenhouse_climate_1_ota_mode
            name: Climate 1 OTA Mode
          - entity: switch.greenhouse_climate_2_ota_mode
            name: Climate 2 OTA Mode
          - entity: switch.greenhouse_soil_2_ota_mode
            name: Soil 2 OTA Mode
          - type: divider
          - entity: script.greenhouse_system_health
            name: System Health Check
            icon: mdi:heart-pulse

  - title: History
    path: history
    icon: mdi:chart-line
    cards:
      # Long-term Temperature Trends
      - type: custom:mini-graph-card
        entities:
          - entity: sensor.greenhouse_climate_1_temperature
            name: Zone 1 Climate
          - entity: sensor.greenhouse_climate_2_temperature
            name: Zone 2 Climate
          - entity: sensor.greenhouse_soil_2_air_temperature_1
            name: Zone 2 Air Temp 1
          - entity: sensor.greenhouse_soil_2_air_temperature_2
            name: Zone 2 Air Temp 2
        name: Temperature History (7 Days)
        hours_to_show: 168
        points_per_hour: 0.25
        line_width: 2
        animate: false
        show:
          extrema: true
          average: true

      # Long-term Humidity Trends
      - type: custom:mini-graph-card
        entities:
          - entity: sensor.greenhouse_climate_1_humidity
            name: Zone 1 Climate
          - entity: sensor.greenhouse_climate_2_humidity
            name: Zone 2 Climate
          - entity: sensor.greenhouse_soil_2_air_humidity_1
            name: Zone 2 Air Hum 1
          - entity: sensor.greenhouse_soil_2_air_humidity_2
            name: Zone 2 Air Hum 2
        name: Humidity History (7 Days)
        hours_to_show: 168
        points_per_hour: 0.25
        line_width: 2
        animate: false
        show:
          extrema: true
          average: true

      # Long-term Soil Moisture Trends
      - type: custom:mini-graph-card
        entities:
          - entity: sensor.greenhouse_soil_1_average_vwc
            name: Zone 1 Soil (Powered)
          - entity: sensor.greenhouse_soil_2_average_vwc
            name: Zone 2 Soil (Battery)
        name: Soil Moisture History (14 Days)
        hours_to_show: 336
        points_per_hour: 0.125
        line_width: 2
        animate: false
        show:
          extrema: true
          average: true
        color_thresholds:
          - value: 35
            color: "#e74c3c"
          - value: 45
            color: "#f39c12"
          - value: 60
            color: "#27ae60"

      # Soil Temperature History
      - type: custom:mini-graph-card
        entities:
          - entity: sensor.greenhouse_soil_2_temperature_1
            name: Soil Temp 1
          - entity: sensor.greenhouse_soil_2_temperature_2
            name: Soil Temp 2
        name: Soil Temperature History (7 Days)
        hours_to_show: 168
        points_per_hour: 0.25
        line_width: 2
        animate: false
        show:
          extrema: true
          average: true

      # Battery Level History
      - type: custom:mini-graph-card
        entities:
          - entity: sensor.greenhouse_soil_2_battery_level
            name: Battery Level
          - entity: sensor.greenhouse_soil_2_battery_voltage
            name: Battery Voltage
            y_axis: secondary
        name: Battery History (30 Days)
        hours_to_show: 720
        points_per_hour: 0.0625
        line_width: 2
        animate: false
        show:
          extrema: true
          average: true
        color_thresholds:
          - value: 20
            color: "#e74c3c"
          - value: 40
            color: "#f39c12"
          - value: 80
            color: "#27ae60"